<html class="_theme-default">
<head>
    <meta charset="utf-8">
    <title>.. Closure trait implementations</title>
    
    <link rel="preload" href="../../assets/index.js" as="script" type="text/javascript" />

    <link rel="stylesheet" type="text/css" href="../../application.css" />
    <link rel="stylesheet" type="text/css" href="../../assets/index.css" />
</head>
<body>
    <div class="_app">
        <devdocs-navbar current="reference/expressions/closure-expr" prefix="../../" listing-src="../../navbar.json"></devdocs-navbar>
        <div class="_container">
            <main class="_content">
                <div class="_page _rust"><h1 class="rule" id="r-expr.closure">
<a class="rule-link" href="#r-expr.closure" title="expr.closure"><span>[expr<wbr>.closure]</wbr></span></a> </h1> <h1 id="closure-expressions">Closure expressions</h1> <div class="rule" id="r-expr.closure.syntax">
<a class="rule-link" href="#r-expr.closure.syntax" title="expr.closure.syntax"><span>[expr<wbr>.closure<wbr>.syntax]</wbr></wbr></span></a> </div> <div class="grammar-container"> <p><strong><sup>Syntax</sup></strong> <br> <span class="grammar-text grammar-production" id="grammar-ClosureExpression" onclick="show_railroad()"><a href="closure-expr#railroad-ClosureExpression">ClosureExpression</a></span> → <br> <span class="grammar-literal">async</span><sup>?</sup>​<sup class="footnote-reference" id="fr-cl-async-edition-1"><a href="#footnote-cl-async-edition">1</a></sup> <br> <span class="grammar-literal">move</span><sup>?</sup> <br> ( <span class="grammar-literal">||</span> | <span class="grammar-literal">|</span> <span class="grammar-text"><a href="closure-expr#grammar-ClosureParameters">ClosureParameters</a></span><sup>?</sup> <span class="grammar-literal">|</span> ) <br> ( <span class="grammar-text"><a href="../expressions#grammar-Expression">Expression</a></span> | <span class="grammar-literal">-&gt;</span> <span class="grammar-text"><a href="../types#grammar-TypeNoBounds">TypeNoBounds</a></span> <span class="grammar-text"><a href="block-expr#grammar-BlockExpression">BlockExpression</a></span> )</p> <p><span class="grammar-text grammar-production" id="grammar-ClosureParameters" onclick="show_railroad()"><a href="closure-expr#railroad-ClosureParameters">ClosureParameters</a></span> → <span class="grammar-text"><a href="closure-expr#grammar-ClosureParam">ClosureParam</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="closure-expr#grammar-ClosureParam">ClosureParam</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup></p> <p><span class="grammar-text grammar-production" id="grammar-ClosureParam" onclick="show_railroad()"><a href="closure-expr#railroad-ClosureParam">ClosureParam</a></span> → <span class="grammar-text"><a href="../attributes#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> <span class="grammar-text"><a href="../patterns#grammar-PatternNoTopAlt">PatternNoTopAlt</a></span> ( <span class="grammar-literal">:</span> <span class="grammar-text"><a href="../types#grammar-Type">Type</a></span> )<sup>?</sup></p> <p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p> </div> <div class="grammar-railroad grammar-hidden"> <div style="width: 466px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ClosureExpression">
<svg class="railroad" viewbox="0 0 466 320" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">  <g class="verticalgrid"> <a class="link" xlink:href="closure-expr.html#grammar-ClosureExpression"> <text class="comment" x="74" y="25"> ClosureExpression</text> </a> <g class="sequence">  <g class="stack">   <g class="sequence"> <g class="optional">  <g class="terminal">  <text x="101" y="71"> async</text> </g> </g> </g>  <g class="sequence"> <g class="optional">  <g class="terminal">  <text x="97" y="131"> move</text> </g> </g> </g>  <g class="sequence"> <g class="choice">  <g class="terminal">  <text x="89" y="179"> ||</text> </g>   <g class="sequence"> <g class="terminal">  <text x="85" y="224"> |</text> </g> <g class="optional">  <a class="link" xlink:href="closure-expr.html#railroad-ClosureParameters"> <g class="nonterminal">  <text x="211" y="224"> ClosureParameters</text> </g> </a> </g> <g class="terminal">  <text x="337" y="224"> |</text> </g>   </g> </g> </g>  <g class="sequence"> <g class="choice">  <a class="link" xlink:href="../expressions.html#railroad-Expression"> <g class="nonterminal">  <text x="121" y="271"> Expression</text> </g> </a>   <g class="sequence"> <g class="terminal">  <text x="89" y="304"> -&gt;</text> </g> <a class="link" xlink:href="../types.html#railroad-TypeNoBounds"> <g class="nonterminal">  <text x="175" y="304"> TypeNoBounds</text> </g> </a> <a class="link" xlink:href="block-expr.html#railroad-BlockExpression"> <g class="nonterminal">  <text x="313" y="304"> BlockExpression</text> </g> </a>   </g> </g> </g> </g>    </g> </g> </svg> </div> <div style="width: 508px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ClosureParameters">
<svg class="railroad" viewbox="0 0 508 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">  <g class="verticalgrid"> <a class="link" xlink:href="closure-expr.html#grammar-ClosureParameters"> <text class="comment" x="74" y="25"> ClosureParameters</text> </a> <g class="sequence">  <g class="sequence"> <a class="link" xlink:href="closure-expr.html#railroad-ClosureParam"> <g class="nonterminal">  <text x="93" y="71"> ClosureParam</text> </g> </a> <g class="optional">  <g class="repeat">   <g class="sequence"> <g class="terminal">  <text x="211" y="71"> ,</text> </g> <a class="link" xlink:href="closure-expr.html#railroad-ClosureParam"> <g class="nonterminal">  <text x="293" y="71"> ClosureParam</text> </g> </a>  </g> </g> </g> <g class="optional">  <g class="terminal">  <text x="435" y="71"> ,</text> </g> </g>   </g>    </g> </g> </svg> </div> <div style="width: 572px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ClosureParam">
<svg class="railroad" viewbox="0 0 572 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">  <g class="verticalgrid"> <a class="link" xlink:href="closure-expr.html#grammar-ClosureParam"> <text class="comment" x="57" y="25"> ClosureParam</text> </a> <g class="sequence">  <g class="sequence"> <g class="optional">  <g class="repeat">   <a class="link" xlink:href="../attributes.html#railroad-OuterAttribute"> <g class="nonterminal">  <text x="137" y="71"> OuterAttribute</text> </g> </a> </g> </g> <a class="link" xlink:href="../patterns.html#railroad-PatternNoTopAlt"> <g class="nonterminal">  <text x="319" y="71"> PatternNoTopAlt</text> </g> </a> <g class="optional">  <g class="sequence"> <g class="terminal">  <text x="437" y="71"> :</text> </g> <a class="link" xlink:href="../types.html#railroad-Type"> <g class="nonterminal">  <text x="487" y="71"> Type</text> </g> </a>  </g> </g>   </g>    </g> </g> </svg> </div> </div> <div class="rule" id="r-expr.closure.intro">
<a class="rule-link" href="#r-expr.closure.intro" title="expr.closure.intro"><span>[expr<wbr>.closure<wbr>.intro]</wbr></wbr></span></a> </div> <p>A <em>closure expression</em>, also known as a lambda expression or a lambda, defines a <a href="../types/closure">closure type</a> and evaluates to a value of that type. The syntax for a closure expression is an optional <code>async</code> keyword, an optional <code>move</code> keyword, then a pipe-symbol-delimited (<code>|</code>) comma-separated list of <a href="../patterns">patterns</a>, called the <em>closure parameters</em> each optionally followed by a <code>:</code> and a type, then an optional <code>-&gt;</code> and type, called the <em>return type</em>, and then an expression, called the <em>closure body operand</em>.</p> <div class="rule" id="r-expr.closure.param-type">
<a class="rule-link" href="#r-expr.closure.param-type" title="expr.closure.param-type"><span>[expr<wbr>.closure<wbr>.param-type]</wbr></wbr></span></a> </div> <p>The optional type after each pattern is a type annotation for the pattern.</p> <div class="rule" id="r-expr.closure.explicit-type-body">
<a class="rule-link" href="#r-expr.closure.explicit-type-body" title="expr.closure.explicit-type-body"><span>[expr<wbr>.closure<wbr>.explicit-type-body]</wbr></wbr></span></a> </div> <p>If there is a return type, the closure body must be a <a href="block-expr">block</a>.</p> <div class="rule" id="r-expr.closure.parameter-restriction">
<a class="rule-link" href="#r-expr.closure.parameter-restriction" title="expr.closure.parameter-restriction"><span>[expr<wbr>.closure<wbr>.parameter-restriction]</wbr></wbr></span></a> </div> <p>A closure expression denotes a function that maps a list of parameters onto the expression that follows the parameters. Just like a <a href="../statements#let-statements"><code>let</code> binding</a>, the closure parameters are irrefutable <a href="../patterns">patterns</a>, whose type annotation is optional and will be inferred from context if not given.</p> <div class="rule" id="r-expr.closure.unique-type">
<a class="rule-link" href="#r-expr.closure.unique-type" title="expr.closure.unique-type"><span>[expr<wbr>.closure<wbr>.unique-type]</wbr></wbr></span></a> </div> <p>Each closure expression has a unique, anonymous type.</p> <div class="rule" id="r-expr.closure.captures">
<a class="rule-link" href="#r-expr.closure.captures" title="expr.closure.captures"><span>[expr<wbr>.closure<wbr>.captures]</wbr></wbr></span></a> </div> <p>Significantly, closure expressions <em>capture their environment</em>, which regular <a href="../items/functions">function definitions</a> do not.</p> <div class="rule" id="r-expr.closure.capture-inference">
<a class="rule-link" href="#r-expr.closure.capture-inference" title="expr.closure.capture-inference"><span>[expr<wbr>.closure<wbr>.capture-inference]</wbr></wbr></span></a> </div> <p>Without the <code>move</code> keyword, the closure expression <a href="../types/closure#capture-modes">infers how it captures each variable from its environment</a>, preferring to capture by shared reference, effectively borrowing all outer variables mentioned inside the closure’s body.</p> <div class="rule" id="r-expr.closure.capture-mut-ref">
<a class="rule-link" href="#r-expr.closure.capture-mut-ref" title="expr.closure.capture-mut-ref"><span>[expr<wbr>.closure<wbr>.capture-mut-ref]</wbr></wbr></span></a> </div> <p>If needed the compiler will infer that instead mutable references should be taken, or that the values should be moved or copied (depending on their type) from the environment.</p> <div class="rule" id="r-expr.closure.capture-move">
<a class="rule-link" href="#r-expr.closure.capture-move" title="expr.closure.capture-move"><span>[expr<wbr>.closure<wbr>.capture-move]</wbr></wbr></span></a> </div> <p>A closure can be forced to capture its environment by copying or moving values by prefixing it with the <code>move</code> keyword. This is often used to ensure that the closure’s lifetime is <code>'static</code>.</p> <div class="rule" id="r-expr.closure.trait-impl">
<a class="rule-link" href="#r-expr.closure.trait-impl" title="expr.closure.trait-impl"><span>[expr<wbr>.closure<wbr>.trait-impl]</wbr></wbr></span></a> </div> <h2 id="closure-trait-implementations">Closure trait implementations</h2> <p>Which traits the closure type implement depends on how variables are captured, the types of the captured variables, and the presence of <code>async</code>. See the <a href="../types/closure#call-traits-and-coercions">call traits and coercions</a> chapter for how and when a closure implements <code>Fn</code>, <code>FnMut</code>, and <code>FnOnce</code>. The closure type implements <a href="../special-types-and-traits#send"><code>Send</code></a> and <a href="../special-types-and-traits#sync"><code>Sync</code></a> if the type of every captured variable also implements the trait.</p> <div class="rule" id="r-expr.closure.async">
<a class="rule-link" href="#r-expr.closure.async" title="expr.closure.async"><span>[expr<wbr>.closure<wbr>.async]</wbr></wbr></span></a> </div> <h2 id="async-closures">Async closures</h2> <div class="rule" id="r-expr.closure.async.intro">
<a class="rule-link" href="#r-expr.closure.async.intro" title="expr.closure.async.intro"><span>[expr<wbr>.closure<wbr>.async<wbr>.intro]</wbr></wbr></wbr></span></a> </div> <p>Closures marked with the <code>async</code> keyword indicate that they are asynchronous in an analogous way to an <a href="../items/functions#r-items.fn.async">async function</a>.</p> <div class="rule" id="r-expr.closure.async.future">
<a class="rule-link" href="#r-expr.closure.async.future" title="expr.closure.async.future"><span>[expr<wbr>.closure<wbr>.async<wbr>.future]</wbr></wbr></wbr></span></a> </div> <p>Calling the async closure does not perform any work, but instead evaluates to a value that implements <a href="https://doc.rust-lang.org/core/future/future/trait.Future.html"><code>Future</code></a> that corresponds to the computation of the body of the closure.</p> <pre data-language="rust">#![allow(unused)]
fn main() {
async fn takes_async_callback(f: impl AsyncFn(u64)) {
    f(0).await;
    f(1).await;
}

async fn example() {
    takes_async_callback(async |i| {
        core::future::ready(i).await;
        println!("done with {i}.");
    }).await;
}
}</pre> <div class="rule" id="r-expr.closure.async.edition2018">
<a class="rule-link" href="#r-expr.closure.async.edition2018" title="expr.closure.async.edition2018"><span>[expr<wbr>.closure<wbr>.async<wbr>.edition2018]</wbr></wbr></wbr></span></a> </div> <div class="alert alert-edition"> <blockquote> <p class="alert-title"><span class="alert-title-edition">2018</span> Edition differences</p> <p>Async closures are only available beginning with Rust 2018.</p> </blockquote> </div> <h2 id="example">Example</h2> <p>In this example, we define a function <code>ten_times</code> that takes a higher-order function argument, and we then call it with a closure expression as an argument, followed by a closure expression that moves values from its environment.</p> <pre data-language="rust">#![allow(unused)]
fn main() {
fn ten_times&lt;F&gt;(f: F) where F: Fn(i32) {
    for index in 0..10 {
        f(index);
    }
}

ten_times(|j| println!("hello, {}", j));
// With type annotations
ten_times(|j: i32| -&gt; () { println!("hello, {}", j) });

let word = "konnichiwa".to_owned();
ten_times(move |j| println!("{}, {}", word, j));
}</pre> <h2 id="attributes-on-closure-parameters">Attributes on closure parameters</h2> <div class="rule" id="r-expr.closure.param-attributes">
<a class="rule-link" href="#r-expr.closure.param-attributes" title="expr.closure.param-attributes"><span>[expr<wbr>.closure<wbr>.param-attributes]</wbr></wbr></span></a> </div> <p>Attributes on closure parameters follow the same rules and restrictions as <a href="../items/functions#attributes-on-function-parameters">regular function parameters</a>.</p>  <ol class="footnote-definition">
<li id="footnote-cl-async-edition"> <p>The <code>async</code> qualifier is not allowed in the 2015 edition. <a href="#fr-cl-async-edition-1">↩</a></p> </li> </ol><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010 The Rust Project Developers<br>Licensed under the Apache License, Version 2.0 or the MIT license, at your option.<br>
    <a href="https://doc.rust-lang.org/reference/expressions/closure-expr.html" class="_attribution-link">https://doc.rust-lang.org/reference/expressions/closure-expr.html</a>
  </p>
</div>
</div>
            </main>
        </div>
    </div>
    <script type="text/javascript" src="../../assets/index.js"></script>
</body>

</html>