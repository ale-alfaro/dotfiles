<html class="_theme-default">
<head>
    <meta charset="utf-8">
    <title>.. Statics &amp; generics</title>
    
    <link rel="preload" href="../../assets/index.js" as="script" type="text/javascript" />

    <link rel="stylesheet" type="text/css" href="../../application.css" />
    <link rel="stylesheet" type="text/css" href="../../assets/index.css" />
</head>
<body>
    <div class="_app">
        <devdocs-navbar current="reference/items/static-items" prefix="../../" listing-src="../../navbar.json"></devdocs-navbar>
        <div class="_container">
            <main class="_content">
                <div class="_page _rust"><h1 class="rule" id="r-items.static">
<a class="rule-link" href="#r-items.static" title="items.static"><span>[items<wbr>.static]</wbr></span></a> </h1> <h1 id="static-items">Static items</h1> <div class="rule" id="r-items.static.syntax">
<a class="rule-link" href="#r-items.static.syntax" title="items.static.syntax"><span>[items<wbr>.static<wbr>.syntax]</wbr></wbr></span></a> </div> <div class="grammar-container"> <p><strong><sup>Syntax</sup></strong> <br> <span class="grammar-text grammar-production" id="grammar-StaticItem" onclick="show_railroad()"><a href="static-items#railroad-StaticItem">StaticItem</a></span> → <br> <span class="grammar-text"><a href="functions#grammar-ItemSafety">ItemSafety</a></span><sup>?</sup>​<sup class="footnote-reference" id="fr-extern-safety-1"><a href="#footnote-extern-safety">1</a></sup> <span class="grammar-literal">static</span> <span class="grammar-literal">mut</span><sup>?</sup> <span class="grammar-text"><a href="../identifiers#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-literal">:</span> <span class="grammar-text"><a href="../types#grammar-Type">Type</a></span> ( <span class="grammar-literal">=</span> <span class="grammar-text"><a href="../expressions#grammar-Expression">Expression</a></span> )<sup>?</sup> <span class="grammar-literal">;</span></p> <p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p> </div> <div class="grammar-railroad grammar-hidden"> <div style="width: 842px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-StaticItem">
<svg class="railroad" viewbox="0 0 842 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">  <g class="verticalgrid"> <a class="link" xlink:href="static-items.html#grammar-StaticItem"> <text class="comment" x="50" y="25"> StaticItem</text> </a> <g class="sequence">  <g class="sequence"> <g class="optional">  <a class="link" xlink:href="functions.html#railroad-ItemSafety"> <g class="nonterminal">  <text x="109" y="71"> ItemSafety</text> </g> </a> </g> <g class="terminal">  <text x="227" y="71"> static</text> </g> <g class="optional">  <g class="terminal">  <text x="317" y="71"> mut</text> </g> </g> <a class="link" xlink:href="../identifiers.html#railroad-IDENTIFIER"> <g class="nonterminal">  <text x="423" y="71"> IDENTIFIER</text> </g> </a> <g class="terminal">  <text x="497" y="71"> :</text> </g> <a class="link" xlink:href="../types.html#railroad-Type"> <g class="nonterminal">  <text x="547" y="71"> Type</text> </g> </a> <g class="optional">  <g class="sequence"> <g class="terminal">  <text x="621" y="71"> =</text> </g> <a class="link" xlink:href="../expressions.html#railroad-Expression"> <g class="nonterminal">  <text x="695" y="71"> Expression</text> </g> </a>  </g> </g> <g class="terminal">  <text x="793" y="71"> ;</text> </g>        </g>    </g> </g> </svg> </div> </div> <div class="rule" id="r-items.static.intro">
<a class="rule-link" href="#r-items.static.intro" title="items.static.intro"><span>[items<wbr>.static<wbr>.intro]</wbr></wbr></span></a> </div> <p>A <em>static item</em> is similar to a <a href="constant-items">constant</a>, except that it represents an allocated object in the program that is initialized with the initializer expression. All references and raw pointers to the static refer to the same allocated object.</p> <div class="rule" id="r-items.static.lifetime">
<a class="rule-link" href="#r-items.static.lifetime" title="items.static.lifetime"><span>[items<wbr>.static<wbr>.lifetime]</wbr></wbr></span></a> </div> <p>Static items have the <code>static</code> lifetime, which outlives all other lifetimes in a Rust program. Static items do not call <a href="../destructors"><code>drop</code></a> at the end of the program.</p> <div class="rule" id="r-items.static.storage-disjointness">
<a class="rule-link" href="#r-items.static.storage-disjointness" title="items.static.storage-disjointness"><span>[items<wbr>.static<wbr>.storage-disjointness]</wbr></wbr></span></a> </div> <p>If the <code>static</code> has a size of at least 1 byte, this allocated object is disjoint from all other such <code>static</code> objects as well as heap allocations and stack-allocated variables. However, the storage of immutable <code>static</code> items can overlap with objects that do not themselves have a unique address, such as <a href="../destructors#constant-promotion">promoteds</a> and <a href="constant-items"><code>const</code> items</a>.</p> <div class="rule" id="r-items.static.namespace">
<a class="rule-link" href="#r-items.static.namespace" title="items.static.namespace"><span>[items<wbr>.static<wbr>.namespace]</wbr></wbr></span></a> </div> <p>The static declaration defines a static value in the <a href="../names/namespaces">value namespace</a> of the module or block where it is located.</p> <div class="rule" id="r-items.static.init">
<a class="rule-link" href="#r-items.static.init" title="items.static.init"><span>[items<wbr>.static<wbr>.init]</wbr></wbr></span></a> </div> <p>The static initializer is a <a href="../const_eval#constant-expressions">constant expression</a> evaluated at compile time. Static initializers may refer to and read from other statics. When reading from mutable statics, they read the initial value of that static.</p> <div class="rule" id="r-items.static.read-only">
<a class="rule-link" href="#r-items.static.read-only" title="items.static.read-only"><span>[items<wbr>.static<wbr>.read-only]</wbr></wbr></span></a> </div> <p>Non-<code>mut</code> static items that contain a type that is not <a href="../interior-mutability">interior mutable</a> may be placed in read-only memory.</p> <div class="rule" id="r-items.static.safety">
<a class="rule-link" href="#r-items.static.safety" title="items.static.safety"><span>[items<wbr>.static<wbr>.safety]</wbr></wbr></span></a> </div> <p>All access to a static is safe, but there are a number of restrictions on statics:</p> <div class="rule" id="r-items.static.sync">
<a class="rule-link" href="#r-items.static.sync" title="items.static.sync"><span>[items<wbr>.static<wbr>.sync]</wbr></wbr></span></a> </div> <ul> <li>The type must have the <a href="https://doc.rust-lang.org/core/marker/trait.Sync.html"><code>Sync</code></a> trait bound to allow thread-safe access.</li> </ul> <div class="rule" id="r-items.static.init.omission">
<a class="rule-link" href="#r-items.static.init.omission" title="items.static.init.omission"><span>[items<wbr>.static<wbr>.init<wbr>.omission]</wbr></wbr></wbr></span></a> </div> <p>The initializer expression must be omitted in an <a href="external-blocks">external block</a>, and must be provided for free static items.</p> <div class="rule" id="r-items.static.safety-qualifiers">
<a class="rule-link" href="#r-items.static.safety-qualifiers" title="items.static.safety-qualifiers"><span>[items<wbr>.static<wbr>.safety-qualifiers]</wbr></wbr></span></a> </div> <p>The <code>safe</code> and <code>unsafe</code> qualifiers are semantically only allowed when used in an <a href="external-blocks">external block</a>.</p> <div class="rule" id="r-items.static.generics">
<a class="rule-link" href="#r-items.static.generics" title="items.static.generics"><span>[items<wbr>.static<wbr>.generics]</wbr></wbr></span></a> </div> <h2 id="statics--generics">Statics &amp; generics</h2> <p>A static item defined in a generic scope (for example in a blanket or default implementation) will result in exactly one static item being defined, as if the static definition was pulled out of the current scope into the module. There will <em>not</em> be one item per monomorphization.</p> <p>This code:</p> <pre data-language="rust">use std::sync::atomic::{AtomicUsize, Ordering};

trait Tr {
    fn default_impl() {
        static COUNTER: AtomicUsize = AtomicUsize::new(0);
        println!("default_impl: counter was {}", COUNTER.fetch_add(1, Ordering::Relaxed));
    }

    fn blanket_impl();
}

struct Ty1 {}
struct Ty2 {}

impl&lt;T&gt; Tr for T {
    fn blanket_impl() {
        static COUNTER: AtomicUsize = AtomicUsize::new(0);
        println!("blanket_impl: counter was {}", COUNTER.fetch_add(1, Ordering::Relaxed));
    }
}

fn main() {
    &lt;Ty1 as Tr&gt;::default_impl();
    &lt;Ty2 as Tr&gt;::default_impl();
    &lt;Ty1 as Tr&gt;::blanket_impl();
    &lt;Ty2 as Tr&gt;::blanket_impl();
}</pre> <p>prints</p> <pre>default_impl: counter was 0
default_impl: counter was 1
blanket_impl: counter was 0
blanket_impl: counter was 1
</pre> <div class="rule" id="r-items.static.mut">
<a class="rule-link" href="#r-items.static.mut" title="items.static.mut"><span>[items<wbr>.static<wbr>.mut]</wbr></wbr></span></a> </div> <h2 id="mutable-statics">Mutable statics</h2> <div class="rule" id="r-items.static.mut.intro">
<a class="rule-link" href="#r-items.static.mut.intro" title="items.static.mut.intro"><span>[items<wbr>.static<wbr>.mut<wbr>.intro]</wbr></wbr></wbr></span></a> </div> <p>If a static item is declared with the <code>mut</code> keyword, then it is allowed to be modified by the program. One of Rust’s goals is to make concurrency bugs hard to run into, and this is obviously a very large source of race conditions or other bugs</p> <div class="rule" id="r-items.static.mut.safety">
<a class="rule-link" href="#r-items.static.mut.safety" title="items.static.mut.safety"><span>[items<wbr>.static<wbr>.mut<wbr>.safety]</wbr></wbr></wbr></span></a> </div> <p>For this reason, an <code>unsafe</code> block is required when either reading or writing a mutable static variable. Care should be taken to ensure that modifications to a mutable static are safe with respect to other threads running in the same process.</p> <div class="rule" id="r-items.static.mut.extern">
<a class="rule-link" href="#r-items.static.mut.extern" title="items.static.mut.extern"><span>[items<wbr>.static<wbr>.mut<wbr>.extern]</wbr></wbr></wbr></span></a> </div> <p>Mutable statics are still very useful, however. They can be used with C libraries and can also be bound from C libraries in an <code>extern</code> block.</p> <pre data-language="rust">#![allow(unused)]
fn main() {
fn atomic_add(_: *mut u32, _: u32) -&gt; u32 { 2 }

static mut LEVELS: u32 = 0;

// This violates the idea of no shared state, and this doesn't internally
// protect against races, so this function is `unsafe`
unsafe fn bump_levels_unsafe() -&gt; u32 {
    unsafe {
        let ret = LEVELS;
        LEVELS += 1;
        return ret;
    }
}

// As an alternative to `bump_levels_unsafe`, this function is safe, assuming
// that we have an atomic_add function which returns the old value. This
// function is safe only if no other code accesses the static in a non-atomic
// fashion. If such accesses are possible (such as in `bump_levels_unsafe`),
// then this would need to be `unsafe` to indicate to the caller that they
// must still guard against concurrent access.
fn bump_levels_safe() -&gt; u32 {
    unsafe {
        return atomic_add(&amp;raw mut LEVELS, 1);
    }
}
}</pre> <div class="rule" id="r-items.static.mut.sync">
<a class="rule-link" href="#r-items.static.mut.sync" title="items.static.mut.sync"><span>[items<wbr>.static<wbr>.mut<wbr>.sync]</wbr></wbr></wbr></span></a> </div> <p>Mutable statics have the same restrictions as normal statics, except that the type does not have to implement the <code>Sync</code> trait.</p> <div class="rule" id="r-items.static.alternate">
<a class="rule-link" href="#r-items.static.alternate" title="items.static.alternate"><span>[items<wbr>.static<wbr>.alternate]</wbr></wbr></span></a> </div> <h2 id="using-statics-or-consts">Using Statics or Consts</h2> <p>It can be confusing whether or not you should use a constant item or a static item. Constants should, in general, be preferred over statics unless one of the following are true:</p> <ul> <li>Large amounts of data are being stored.</li> <li>The single-address property of statics is required.</li> <li>Interior mutability is required.</li> </ul>  <ol class="footnote-definition">
<li id="footnote-extern-safety"> <p>The <code>safe</code> and <code>unsafe</code> function qualifiers are only allowed semantically within <code>extern</code> blocks. <a href="#fr-extern-safety-1">↩</a></p> </li> </ol><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010 The Rust Project Developers<br>Licensed under the Apache License, Version 2.0 or the MIT license, at your option.<br>
    <a href="https://doc.rust-lang.org/reference/items/static-items.html" class="_attribution-link">https://doc.rust-lang.org/reference/items/static-items.html</a>
  </p>
</div>
</div>
            </main>
        </div>
    </div>
    <script type="text/javascript" src="../../assets/index.js"></script>
</body>

</html>