<html class="_theme-default">
<head>
    <meta charset="utf-8">
    <title>6.57. x86-Specific Memory Model Extensions for Transactional Memory</title>
    
    <link rel="preload" href="assets/index.js" as="script" type="text/javascript" />

    <link rel="stylesheet" type="text/css" href="application.css" />
    <link rel="stylesheet" type="text/css" href="assets/index.css" />
</head>
<body>
    <div class="_app">
        <devdocs-navbar current="x86-specific-memory-model-extensions-for-transactional-memory" prefix="" listing-src="navbar.json"></devdocs-navbar>
        <div class="_container">
            <main class="_content">
                <div class="_page _gcc"><h1 class="section" id="x86-Specific-Memory-Model-Extensions-for-Transactional-Memory">6.57 x86-Specific Memory Model Extensions for Transactional Memory</h1> <p>The x86 architecture supports additional memory ordering flags to mark critical sections for hardware lock elision. These must be specified in addition to an existing memory order to atomic intrinsics. </p> <dl compact> <dt><code>__ATOMIC_HLE_ACQUIRE</code></dt> <dd><p>Start lock elision on a lock variable. Memory order must be <code>__ATOMIC_ACQUIRE</code> or stronger. </p></dd> <dt><code>__ATOMIC_HLE_RELEASE</code></dt> <dd><p>End lock elision on a lock variable. Memory order must be <code>__ATOMIC_RELEASE</code> or stronger. </p></dd> </dl> <p>When a lock acquire fails, it is required for good performance to abort the transaction quickly. This can be done with a <code>_mm_pause</code>. </p> <div class="smallexample"> <pre class="smallexample" data-language="cpp">#include &lt;immintrin.h&gt; // For _mm_pause

int lockvar;

/* Acquire lock with lock elision */
while (__atomic_exchange_n(&amp;lockvar, 1, __ATOMIC_ACQUIRE|__ATOMIC_HLE_ACQUIRE))
    _mm_pause(); /* Abort failed transaction */
...
/* Free lock with lock elision */
__atomic_store_n(&amp;lockvar, 0, __ATOMIC_RELEASE|__ATOMIC_HLE_RELEASE);</pre>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; Free Software Foundation<br>Licensed under the GNU Free Documentation License, Version 1.3.<br>
    <a href="https://gcc.gnu.org/onlinedocs/gcc-9.5.0/gcc/x86-specific-memory-model-extensions-for-transactional-memory.html" class="_attribution-link">https://gcc.gnu.org/onlinedocs/gcc-9.5.0/gcc/x86-specific-memory-model-extensions-for-transactional-memory.html</a>
  </p>
</div>
</div>
            </main>
        </div>
    </div>
    <script type="text/javascript" src="assets/index.js"></script>
</body>

</html>